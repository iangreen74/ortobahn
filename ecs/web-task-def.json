{
  "family": "ortobahn-web",
  "networkMode": "awsvpc",
  "requiresCompatibilities": ["FARGATE"],
  "cpu": "256",
  "memory": "512",
  "executionRoleArn": "arn:aws:iam::418295677815:role/ortobahn-ecs-execution",
  "taskRoleArn": "arn:aws:iam::418295677815:role/ortobahn-ecs-task",
  "containerDefinitions": [
    {
      "name": "ortobahn-web",
      "image": "418295677815.dkr.ecr.us-west-2.amazonaws.com/ortobahn:latest",
      "essential": true,
      "command": ["python", "-m", "ortobahn", "web", "--host", "0.0.0.0", "--port", "8000"],
      "portMappings": [
        {
          "containerPort": 8000,
          "protocol": "tcp"
        }
      ],
      "environment": [
        {"name": "WEB_HOST", "value": "0.0.0.0"},
        {"name": "WEB_PORT", "value": "8000"},
        {"name": "AUTONOMOUS_MODE", "value": "true"},
        {"name": "COGNITO_REGION", "value": "us-west-2"},
        {"name": "PIPELINE_INTERVAL_HOURS", "value": "8"},
        {"name": "LOG_LEVEL", "value": "INFO"},
        {"name": "USE_BEDROCK", "value": "true"},
        {"name": "BEDROCK_REGION", "value": "us-west-2"},
        {"name": "DEPLOY_SHA", "value": "unknown"}
      ],
      "secrets": [
        {"name": "ANTHROPIC_API_KEY", "valueFrom": "arn:aws:secretsmanager:us-west-2:418295677815:secret:ortobahn/prod-TaDxEG:ANTHROPIC_API_KEY::"},
        {"name": "DATABASE_URL", "valueFrom": "arn:aws:secretsmanager:us-west-2:418295677815:secret:ortobahn/prod-TaDxEG:DATABASE_URL::"},
        {"name": "ORTOBAHN_SECRET_KEY", "valueFrom": "arn:aws:secretsmanager:us-west-2:418295677815:secret:ortobahn/prod-TaDxEG:ORTOBAHN_SECRET_KEY::"},
        {"name": "BLUESKY_HANDLE", "valueFrom": "arn:aws:secretsmanager:us-west-2:418295677815:secret:ortobahn/prod-TaDxEG:BLUESKY_HANDLE::"},
        {"name": "BLUESKY_APP_PASSWORD", "valueFrom": "arn:aws:secretsmanager:us-west-2:418295677815:secret:ortobahn/prod-TaDxEG:BLUESKY_APP_PASSWORD::"},
        {"name": "STRIPE_SECRET_KEY", "valueFrom": "arn:aws:secretsmanager:us-west-2:418295677815:secret:ortobahn/prod-TaDxEG:STRIPE_SECRET_KEY::"},
        {"name": "STRIPE_PUBLISHABLE_KEY", "valueFrom": "arn:aws:secretsmanager:us-west-2:418295677815:secret:ortobahn/prod-TaDxEG:STRIPE_PUBLISHABLE_KEY::"},
        {"name": "STRIPE_WEBHOOK_SECRET", "valueFrom": "arn:aws:secretsmanager:us-west-2:418295677815:secret:ortobahn/prod-TaDxEG:STRIPE_WEBHOOK_SECRET::"},
        {"name": "STRIPE_PRICE_ID", "valueFrom": "arn:aws:secretsmanager:us-west-2:418295677815:secret:ortobahn/prod-TaDxEG:STRIPE_PRICE_ID::"},
        {"name": "COGNITO_USER_POOL_ID", "valueFrom": "arn:aws:secretsmanager:us-west-2:418295677815:secret:ortobahn/prod-TaDxEG:COGNITO_USER_POOL_ID::"},
        {"name": "COGNITO_CLIENT_ID", "valueFrom": "arn:aws:secretsmanager:us-west-2:418295677815:secret:ortobahn/prod-TaDxEG:COGNITO_CLIENT_ID::"}
      ],
      "logConfiguration": {
        "logDriver": "awslogs",
        "options": {
          "awslogs-group": "/ecs/ortobahn",
          "awslogs-region": "us-west-2",
          "awslogs-stream-prefix": "web"
        }
      },
      "healthCheck": {
        "command": ["CMD-SHELL", "python -c \"import urllib.request; urllib.request.urlopen('http://localhost:8000/health')\" || exit 1"],
        "interval": 30,
        "timeout": 5,
        "retries": 3,
        "startPeriod": 30
      }
    }
  ]
}
